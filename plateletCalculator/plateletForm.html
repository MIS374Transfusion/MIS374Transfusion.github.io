<!-- page for user to enter the patient's weight. will store the weight and recommendation in a session storage variable to access later on in the process -->


<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- sets the width of page to follow hte screen-width of device -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platelet Calculator</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet"> <!-- pulling font from Google -->
    <link rel="stylesheet" href="../bootstrap-4.3.1-dist/css/bootstrap.css">
    <link rel="stylesheet" href="../bootstrap-4.3.1-dist/css/custom.css">


</head>
<body>
  <!-- Navigation bar -->
  <nav class="navbar navbar-expand-sm bg-light justify-content-between">
        <ul class ="navbar-nav">
            <li class="nav-item">
                        <a class="nav-link" style="color:#1a4197" href="../index.html">Home</a>
            </li>
        </ul>

        <div>
            <img src="../dcmcLogo.png" class="display-inblock float-right" width="64" height="32" alt="">
        </div>
    </nav>


  <div class = "m-4">
    <h4 align = 'center'>Please enter patient information</h4>
  </div>

<form action = "plateletresults.html" onsubmit ="return plateletcalculate()" align = 'center'>

      <label class="sr-only" for="preCount" >preCount</label>
        <div class="input-group m-2">
            <span class="input-group-text">Pre-Transfusion Platelet Count:</span>
        </div>
        <div class="form-group row m-2">
              <input type="number" min="1" max="50" step = ".01" class="form-control-lg" id="preCount" placeholder="Norm: 0-50" required > <!-- restrict input range to 1-50 -->
              <span class="input-group-text">x 10<sup>3</sup>/&#181;L</span>
          </div>
        </div>

      <label class="sr-only" for="postCount" >postCount</label>
      <div class="input-group m-2">
          <span class="input-group-text">Post-Transfusion Platelet Count:</span>
      </div>
      <div class="form-group row m-2">
            <input type="number" step = ".01" class="form-control-lg" min="0" max="150" id="postCount" placeholder="Norm: 50-150" required > <!-- restrict input range to 50-150 -->
            <span class="input-group-text">x 10<sup>3</sup>/&#181;L</span>
        </div>
      </div>

      <label class="sr-only" for="plateletWeight" >plateletWeight</label>
      <div class="input-group m-2">
          <span class="input-group-text">Weight:</span>
      </div>
      <div class="form-group row m-2">
          <input type="number" step = ".01" class="form-control-lg" min="1" id="plateletWeight" placeholder="Weight" required > 
          <span class="input-group-text">kg</span>
      </div>

      <label class="sr-only" for="plateletHeight" >plateletHeight</label>
      <div class="input-group m-2">
          <span class="input-group-text">Height:</span>
      </div>
      <div class="form-group row m-2">
          <input type="number" step = ".01" class="form-control-lg" min="1" id="plateletHeight" placeholder="Height" required >
          <span class="input-group-text">cm</span>

      </div>
    </div>

      <label class="sr-only" for="numPlatelets" >numPlatelets</label>
      <div class="input-group m-2">
          <span class="input-group-text">Number of Platelets Transfused:</span>
      </div>
      <div class="form-group row m-2">
          <input type="number" step = ".01" class="form-control-lg" min="" max="" id="numPlatelets" placeholder="Apheresis unit or mls" required data-error-msg=""><span id="error"></span>
          <div class="col-xs-10">
            <small class="text-muted">One apheresis unit is ~3.0 x 10ยนยน plts</small>
          </div>
      </div>
<!--       <div class="col-xs-10"> -->

      <!-- button type="button" class="btn btn-light">x 10<sup>11</sup>&nbsp;plts</button> -->

<!--       <label class="btn-lg btn-secondary" onclick="changeAttributes()">
          <input type="radio" name="condition" data-toggle="button" id="plts_unit" autocomplete="off" required> x 10<sup>11</sup>&nbsp;plts
      </label>

      <label class="btn-lg btn-secondary" onclick="changeAttributes()">
          <input type="radio" name="condition" data-toggle="button" id="mls_unit" autocomplete="off"> mls
      </label> -->



  <a href='../educationalchoices.html'><button type="button" class="btn-lg btn-primary">Back</button></a> <!-- back button, to change the directory, edit the href section--> 

  <button type="submit" class="btn-lg btn-primary">Next</button>

</form>

<!-- <script>


  // function changeAttributes() {
  //   var numPlates = document.getElementById("numPlatelets");

  //   if (document.getElementById("plts_unit").checked) {
  //     numPlates.setAttribute("placeholder", "plts");
  //     numPlates.setAttribute("min", "1");
  //     numPlates.setAttribute("max", "10");
  //   }

  //   if (document.getElementById("mls_unit").checked) {
  //     numPlates.setAttribute("placeholder", "mls");
  //     numPlates.setAttribute("min", "1");
  //   }    
  // }

  function changeAttributes() {

  function changeAttributes() {
    var numPlates = document.getElementById("numPlatelets");

    if (document.getElementById("plts_unit").checked) {
      numPlates.setAttribute("placeholder", "plts");
      numPlates.setAttribute("min", "1");
      numPlates.setAttribute("max", "10");
    }

    if (document.getElementById("mls_unit").checked) {
      numPlates.setAttribute("placeholder", "mls");
      numPlates.setAttribute("min", "1");
    }    
  }
  function validateNumPlates() {

    var numPlates = document.getElementById("numPlatelets");

    if (document.getElementById("plts_unit").checked) {
      numPlates.setAttribute("placeholder", "plts");
      numPlates.setAttribute("min", "1");
      numPlates.setAttribute("max", "10");
    }

    if (document.getElementById("mls_unit").checked) {
      numPlates.setAttribute("placeholder", "mls");
      numPlates.setAttribute("min", "1");
    }    
  }
  function validateNumPlates() {
    var numPlates = document.getElementById("numPlatelets");

</script> -->


<script>
  function plateletcalculate()
  { 

      var numPlatelets = document.getElementById("numPlatelets").value;

      if (numPlatelets > 3 && numPlatelets < 30)
      {
        alert("'Platelets Transfused' input incorrect. Please try again.");
        //returnToPreviousPage();
        return false;
      }


      else
      {



        var prCount = document.getElementById("preCount").value; 
        var poCount = document.getElementById("postCount").value; 
        var weight = document.getElementById("plateletWeight").value;
        var height = document.getElementById("plateletHeight").value;
        var numplates = document.getElementById("numPlatelets").value;
        window.sessionStorage.setItem("preCount", prCount);
        window.sessionStorage.setItem("postCount", poCount);
        window.sessionStorage.setItem("plateletWeight", weight);
        window.sessionStorage.setItem("plateletHeight", height);
        window.sessionStorage.setItem("numPlatelets", numplates);
        var cci = "";

        if (numplates <= 3) {
          // convert to pre and post platelet counts (user input times 10^3)
          converted_prCount = prCount * (Math.pow(10, 3));
          converted_poCount = poCount * (Math.pow(10, 3));

          diffCount = (converted_poCount - converted_prCount);

          bsa_pre = (height * weight)/3600;

          bsa = Math.sqrt(bsa_pre);

          bsa_round = Number((bsa).toFixed(3));

          cci_pre = diffCount * (bsa_round/numplates);

          cci = Math.trunc(cci_pre);

          window.sessionStorage.setItem("result", cci);
        }

        if (numplates >= 31) {
          // convert to pre and post platelet counts (user input times 10^3)
          converted_prCount = prCount * (Math.pow(10, 3));
          converted_poCount = poCount * (Math.pow(10, 3));

          // convert to number of platelets if mls radio button is checked
          converted_numplates = numplates/100

          diffCount = (converted_poCount - converted_prCount);

          bsa_pre = (height * weight)/3600;

          bsa = Math.sqrt(bsa_pre);

          bsa_round = Number((bsa).toFixed(3));

          cci_pre = diffCount * (bsa_round/converted_numplates);

          cci = Math.trunc(cci_pre);

          window.sessionStorage.setItem("result", cci);
        }


        return true;
      }
      



        if (numplates >= 4 && numplates <= 30) {
          //document.getElementById('error').innerHTML = "Not allowed: 4-30"
          numplates.setAttribute("data-error-msg", "Must not be between 4-30");
        }


        // if (document.getElementById("plts_unit").checked) {
        //   // convert to pre and post platelet counts (user input times 10^3)
        //   converted_prCount = prCount * (Math.pow(10, 3));
        //   converted_poCount = poCount * (Math.pow(10, 3));

        //   diffCount = (converted_poCount - converted_prCount);

        //   bsa_pre = (height * weight)/3600;

        //   bsa = Math.sqrt(bsa_pre);

        //   bsa_round = Number((bsa).toFixed(3));

        //   cci_pre = diffCount * (bsa_round/numplates);

        //   cci = Math.trunc(cci_pre);

        //   window.sessionStorage.setItem("result", cci);

        // }

        // if (document.getElementById("mls_unit").checked) {
        //   // convert to pre and post platelet counts (user input times 10^3)
        //   converted_prCount = prCount * (Math.pow(10, 3));
        //   converted_poCount = poCount * (Math.pow(10, 3));

        //   // convert to number of platelets if mls radio button is checked
        //   converted_numplates = numplates/100

        //   diffCount = (converted_poCount - converted_prCount);

        //   bsa_pre = (height * weight)/3600;

        //   bsa = Math.sqrt(bsa_pre);

        //   bsa_round = Number((bsa).toFixed(3));

        //   cci_pre = diffCount * (bsa_round/converted_numplates);

        //   cci = Math.trunc(cci_pre);

        //   window.sessionStorage.setItem("result", cci);

        //}

        
  }

</script>

</body>
</html>

